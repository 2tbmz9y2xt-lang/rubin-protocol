version: "1.1"
gate: CV-VAULT
status: PASS
description: "CORE_VAULT_V1: owner vs recovery branches, timelock boundary errors, and deterministic parsing hardening (apply-utxo)"
tests:
  - id: VAULT-01
    title: "Recovery FAIL: timelock not met => TX_ERR_TIMELOCK_NOT_MET (pre-signature)"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 999
      chain_timestamp: 1700000999
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "444444444444444444444444444444444444444444444444444444444444444400e803000000000000070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e0"
          creation_height: 1
    expected_error: TX_ERR_TIMELOCK_NOT_MET
    consensus: true

  - id: VAULT-02
    title: "Owner path reaches signature: correct key_id but signature invalid => TX_ERR_SIG_INVALID"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e000e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 1
    expected_error: TX_ERR_SIG_INVALID
    consensus: true

  - id: VAULT-03
    title: "FAIL: owner_key_id == recovery_key_id => TX_ERR_PARSE"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e000e803000000000000070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e0"
          creation_height: 1
    expected_error: TX_ERR_PARSE
    consensus: true

  - id: VAULT-04
    title: "FAIL: invalid lock_mode (0x02) => TX_ERR_PARSE"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e002e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 1
    expected_error: TX_ERR_PARSE
    consensus: true

  - id: VAULT-05
    title: "FAIL: sentinel witness forbidden for VAULT => TX_ERR_SIG_ALG_INVALID"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: false
      tx_hex: "010000000100000000000000010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000001000000"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e000e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 1
    expected_error: TX_ERR_SIG_ALG_INVALID
    consensus: true

  - id: VAULT-06
    title: "Owner path: spend_delay=0 (legacy len=73) still reaches signature => TX_ERR_SIG_INVALID"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e000e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 1
    expected_error: TX_ERR_SIG_INVALID
    consensus: true

  - id: VAULT-07
    title: "Owner path: spend_delay>0 not met => TX_ERR_TIMELOCK_NOT_MET (pre-signature)"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 500
      chain_timestamp: 1700000500
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e0f00300000000000000e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 100
    expected_error: TX_ERR_TIMELOCK_NOT_MET
    consensus: true

  - id: VAULT-08
    title: "Owner path: spend_delay>0 met => still reaches signature => TX_ERR_SIG_INVALID"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 2000
      chain_timestamp: 1700002000
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e0f00300000000000000e8030000000000005555555555555555555555555555555555555555555555555555555555555555"
          creation_height: 10
    expected_error: TX_ERR_SIG_INVALID
    consensus: true

  - id: VAULT-09
    title: "FAIL: invalid VAULT covenant_data_len (74) => TX_ERR_PARSE"
    context:
      chain_id_hex: "7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00"
      chain_height: 10
      chain_timestamp: 1700000010
      suite_id_02_active: true
      tx_hex: "0100000001000000000000000101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000010240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100"
      utxo_set:
        - txid: "0101010101010101010101010101010101010101010101010101010101010101"
          vout: 0
          value: 1000
          covenant_type: 257
          covenant_data: "070fa1ab6fcc557ed14d42941f1967693048551eb9042a8d0a057afbd75e81e000e803000000000000555555555555555555555555555555555555555555555555555555555555555500"
          creation_height: 1
    expected_error: TX_ERR_PARSE
    consensus: true
