version: "1.1"
gate: CV-COINBASE
status: PASS
description: >
  Coinbase subsidy formula correctness and non-overflow (T-015).
  Tests cover: linear emission remainder distribution, transition to zero subsidy,
  subsidy-exceeded rejection, and u64 non-overflow at all valid heights.
  Ref: CANONICAL ยง4.5, ยง1.2 (SUBSIDY_TOTAL_MINED, SUBSIDY_DURATION_BLOCKS).

tests:
  - id: COINBASE-01
    title: "PASS: genesis subsidy (h=0) is BASE+1 (remainder region)"
    context:
      block_height: 0
    expected_subsidy: 7529089665
    expected_epoch: 0
    consensus: true
    theorem: T-015

  - id: COINBASE-02
    title: "PASS: last remainder block (h=REM-1) subsidy = BASE+1"
    context:
      block_height: 806399
    expected_subsidy: 7529089665
    expected_epoch: 0
    consensus: true
    theorem: T-015

  - id: COINBASE-03
    title: "PASS: first base-only block (h=REM) subsidy = BASE"
    context:
      block_height: 806400
    expected_subsidy: 7529089664
    expected_epoch: 0
    consensus: true
    theorem: T-015

  - id: COINBASE-04
    title: "PASS: last subsidized block (h=N-1) subsidy = BASE"
    context:
      block_height: 1314899
    expected_subsidy: 7529089664
    expected_epoch: 0
    consensus: true
    theorem: T-015

  - id: COINBASE-05
    title: "PASS: first zero-subsidy block (h=N) subsidy = 0"
    context:
      block_height: 1314900
    expected_subsidy: 0
    expected_epoch: 1
    consensus: true
    theorem: T-015

  - id: COINBASE-06
    title: "PASS: max u32 height (h=4_294_967_295) subsidy = 0 (no overflow)"
    context:
      block_height: 4294967295
    expected_subsidy: 0
    expected_epoch: 1
    consensus: true
    theorem: T-015

  - id: COINBASE-07
    title: "FAIL: coinbase output value > subsidy + fees (non-genesis) => BLOCK_ERR_SUBSIDY_EXCEEDED"
    context:
      block_height: 1
      fees_in_block: 0
      coinbase_output_value: 7529089666
    expected_error: BLOCK_ERR_SUBSIDY_EXCEEDED
    consensus: true
    theorem: T-015

  - id: COINBASE-08
    title: "FAIL: coinbase output value > subsidy+fees even with fees (non-genesis) => BLOCK_ERR_SUBSIDY_EXCEEDED"
    context:
      block_height: 1
      fees_in_block: 1000
      coinbase_output_value: 7529090666
    expected_error: BLOCK_ERR_SUBSIDY_EXCEEDED
    consensus: true
    theorem: T-015

  - id: COINBASE-09
    title: "PASS: coinbase value = subsidy + fees exactly (boundary, non-genesis)"
    context:
      block_height: 1
      fees_in_block: 1000
      coinbase_output_value: 7529090665
    expected_code: PASS
    consensus: true
    theorem: T-015

