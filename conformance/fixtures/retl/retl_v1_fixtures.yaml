test_sets:
  - id: RETL-01-minimal-batch-devnet
    kind: retl
    network: rubin-devnet
    chain_id_hex: 7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00
    descriptor_bytes_hex: 0102400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000000000
    expect:
      retl_domain_id_hex: 07641c207751680af86d1bdcf44d15150a146016a511677ca0b1191f3822ec1f
      signing_preimage_hash_hex: a3b9a50ccb73c66b1df793648b72c94441c4c3ea40cb5f2608287c25875a5a59
      anchor_data_hex: 525542494e2d5245544c2f763107641c207751680af86d1bdcf44d15150a146016a511677ca0b1191f3822ec1f0100000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111112222222222222222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333302400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000
      # DEV-ONLY: this fixture is validated against the local shim loader path.
      # In non-dev / non-shim runs this may remain UNSUPPORTED; do not treat as
      # a production consensus-level signal.
      signature_verify: true

  - id: RETL-01-minimal-batch-testnet
    kind: retl
    network: rubin-testnet
    chain_id_hex: abb57bd1efb9f114ed060ef0c633d87fc6b35c737f1d70b66864a5557d46757d
    descriptor_bytes_hex: 0102400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000000000
    expect:
      retl_domain_id_hex: fcec6657673c83bb8af5115b781b071419d27a38ff32852214d35be1a59dc7a7
      signing_preimage_hash_hex: 18b4e05c693f00c20181a5665f353a88b449b316371c14bbf02b180e43e31923
      anchor_data_hex: 525542494e2d5245544c2f7631fcec6657673c83bb8af5115b781b071419d27a38ff32852214d35be1a59dc7a70100000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111112222222222222222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333302400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000
      # Production fixture: signature verification is consensus-optional for RETL in v1.1.
      # Keep false until public witness key and signing flow is standardized.
      signature_verify: false

  - id: RETL-01-minimal-batch-mainnet
    kind: retl
    network: rubin-mainnet
    chain_id_hex: b71f012bdfacaf2ef127d909c43caf2de7d24a13066f746c9b47112c43170773
    descriptor_bytes_hex: 0102400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000000000
    expect:
      retl_domain_id_hex: 4fa2435dc18dfbe679b8e415bf4d15693083631fe090d92a722583bc0a6e8d01
      signing_preimage_hash_hex: 116b1991948c5832facd05d3b4c45165a07ba5547073a07796deef0c550a1ce6
      anchor_data_hex: 525542494e2d5245544c2f76314fa2435dc18dfbe679b8e415bf4d15693083631fe090d92a722583bc0a6e8d010100000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111112222222222222222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333302400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000
      # Production fixture: signature verification is consensus-optional for RETL in v1.1.
      # Keep false until public witness key and signing flow is standardized.
      signature_verify: false

  - id: RETL-02-invalid-magic
    kind: retl
    network: rubin-devnet
    chain_id_hex: 7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00
    anchor_data_hex: 525542494e2d524554580176310000
    expect:
      parse_ok: false
      error: RETL_ERR_MAGIC

  - id: RETL-03-truncated-payload
    kind: retl
    network: rubin-devnet
    chain_id_hex: 7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00
    # Same prefix "RUBIN-RETL/v1" then truncated payload bytes.
    anchor_data_hex: 525542494e2d5245544c2f763107641c207751680a
    expect:
      parse_ok: false
      error: RETL_ERR_TRUNCATED

  - id: RETL-04-nonminimal-compactsize-in-witness
    kind: retl
    network: rubin-devnet
    chain_id_hex: 7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00
    descriptor_bytes_hex: 0102400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000000000
    expect:
      # The witness pubkey_length is encoded as 0xfd 0x40 0x00 (non-minimal for 64).
      parse_ok: false
      error: RETL_ERR_COMPACTSIZE_NONMINIMAL
    anchor_data_hex: 525542494e2d5245544c2f763107641c207751680af86d1bdcf44d15150a146016a511677ca0b1191f3822ec1f0100000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111112222222222222222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333302fd40000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000

  - id: RETL-05-batch-number-discontinuity
    kind: retl
    network: rubin-devnet
    chain_id_hex: 7dcf48a266788491e77bbb7b9c97ad6a2c89b882293dfaf3bdebeec62548cc00
    descriptor_bytes_hex: 0102400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000000000
    expect:
      parse_ok: true
      # Indexer-level expectation: discontinuity must be handled by policy (not L1 consensus).
      indexer_warning: RETL_WARN_BATCH_DISCONTINUITY
    # Same as RETL-01, but batch_number = 2 (u64le), and prev_batch_hash is all-zero (likely invalid for a live domain).
    anchor_data_hex: 525542494e2d5245544c2f763107641c207751680af86d1bdcf44d15150a146016a511677ca0b1191f3822ec1f0200000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111112222222222222222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333302400102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f4000
